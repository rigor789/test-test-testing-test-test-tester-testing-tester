{
  "version": 3,
  "sources": ["../src/NativeScriptPreviewWebpackPlugin.ts"],
  "sourcesContent": ["import { createFsFromVolume, Volume } from \"memfs\";\nimport { lookup as mime } from \"mime-types\";\nimport path from \"path\";\n\nfunction tapProcessSend(\n  callback: (send: typeof process.send, ...args: any) => void\n) {\n  const currentSend = process.send;\n\n  if (!currentSend) {\n    return;\n  }\n\n  process.send = (...args) => {\n    const res = currentSend.apply(process, args);\n\n    callback(currentSend.bind(process), ...args);\n\n    return res;\n  };\n}\n\nexport class NativeScriptPreviewWebpackPlugin {\n  constructor(private fs = createFsFromVolume(new Volume())) {}\n\n  apply(compiler) {\n    const outPath = compiler.options.output.path;\n    compiler.outputFileSystem = this.fs;\n\n    tapProcessSend((send, message) => {\n      if (!message) {\n        return;\n      }\n\n      try {\n        if (message.type !== \"compilation\") {\n          return;\n        }\n\n        const { emittedAssets, staleAssets } = message.data;\n\n        const dataToSend = {\n          type: \"files\",\n          data: {\n            emittedAssets: emittedAssets.map((asset) => {\n              const assetPath = `${outPath}/${asset}`;\n              const { size } = this.fs.statSync(assetPath);\n              return {\n                path: asset,\n                type: mime(path.extname(asset)),\n                size,\n                contents: this.fs.readFileSync(`${outPath}/${asset}`),\n              };\n            }),\n            staleAssets,\n          },\n        };\n\n        send(dataToSend);\n      } catch (err) {\n        console.log(err);\n      }\n    });\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA,mBAA2C;AAC3C,wBAA+B;AAC/B,kBAAiB;AAEjB,wBACE,UACA;AACA,QAAM,cAAc,QAAQ;AAE5B,MAAI,CAAC,aAAa;AAChB;AAAA;AAGF,UAAQ,OAAO,IAAI,SAAS;AAC1B,UAAM,MAAM,YAAY,MAAM,SAAS;AAEvC,aAAS,YAAY,KAAK,UAAU,GAAG;AAEvC,WAAO;AAAA;AAAA;AAIJ,uCAAuC;AAAA,EAC5C,YAAoB,KAAK,qCAAmB,IAAI,wBAAW;AAAvC;AAAA;AAAA,EAEpB,MAAM,UAAU;AACd,UAAM,UAAU,SAAS,QAAQ,OAAO;AACxC,aAAS,mBAAmB,KAAK;AAEjC,mBAAe,CAAC,MAAM,YAAY;AAChC,UAAI,CAAC,SAAS;AACZ;AAAA;AAGF,UAAI;AACF,YAAI,QAAQ,SAAS,eAAe;AAClC;AAAA;AAGF,cAAM,EAAE,eAAe,gBAAgB,QAAQ;AAE/C,cAAM,aAAa;AAAA,UACjB,MAAM;AAAA,UACN,MAAM;AAAA,YACJ,eAAe,cAAc,IAAI,CAAC,UAAU;AAC1C,oBAAM,YAAY,GAAG,WAAW;AAChC,oBAAM,EAAE,SAAS,KAAK,GAAG,SAAS;AAClC,qBAAO;AAAA,gBACL,MAAM;AAAA,gBACN,MAAM,8BAAK,oBAAK,QAAQ;AAAA,gBACxB;AAAA,gBACA,UAAU,KAAK,GAAG,aAAa,GAAG,WAAW;AAAA;AAAA;AAAA,YAGjD;AAAA;AAAA;AAIJ,aAAK;AAAA,eACE,KAAP;AACA,gBAAQ,IAAI;AAAA;AAAA;AAAA;AAAA;",
  "names": []
}
